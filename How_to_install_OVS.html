<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>How to install OVS (Open Virtual Swtich) - My personal blog note</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://didier.bernaudeau.net/How_to_install_OVS.html">

        <meta name="author" content="Didier BERNAUDEAU" />
        <meta name="keywords" content="virtualization,Gentoo" />
        <meta name="description" content="Open vSwitch is a virtual switch with advanced functionnality such as isolation (vlan), monitoring and automated control. This tutorial describes how to install Open vSwitch in kernel space and how to configure LibVirt to use a virtual switch with KVM guest. However, there is a lot of functionality available with Open Virtual Switch that this article does not touch. You can setup VLAN tagging, QoS rules, create re-routing rules, block IP address, block ports, and much more. Feel free to reference online documentation and man pages if you are interested in adding complex functionality to the controller." />

        <meta property="og:site_name" content="My personal blog note" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="How to install OVS (Open Virtual Swtich)"/>
        <meta property="og:url" content="http://didier.bernaudeau.net/How_to_install_OVS.html"/>
        <meta property="og:description" content="Open vSwitch is a virtual switch with advanced functionnality such as isolation (vlan), monitoring and automated control. This tutorial describes how to install Open vSwitch in kernel space and how to configure LibVirt to use a virtual switch with KVM guest. However, there is a lot of functionality available with Open Virtual Switch that this article does not touch. You can setup VLAN tagging, QoS rules, create re-routing rules, block IP address, block ports, and much more. Feel free to reference online documentation and man pages if you are interested in adding complex functionality to the controller."/>
        <meta property="article:published_time" content="2016-09-05" />
            <meta property="article:section" content="Tutorials" />
            <meta property="article:tag" content="virtualization" />
            <meta property="article:tag" content="Gentoo" />
            <meta property="article:author" content="Didier BERNAUDEAU" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://didier.bernaudeau.net/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://didier.bernaudeau.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://didier.bernaudeau.net/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://didier.bernaudeau.net/theme/css/style.css" type="text/css"/>

        <link href="http://didier.bernaudeau.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="My personal blog note ATOM Feed"/>



        <link href="http://didier.bernaudeau.net/feeds/tutorials.atom.xml" type="application/atom+xml" rel="alternate"
              title="My personal blog note Tutorials ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://didier.bernaudeau.net/" class="navbar-brand">
My personal blog note            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/category/articles.html">Articles</a></li>
                    <li><a href="/category/tutorials.html">Tutorials</a></li>
                    <li><a href="/category/talk.html">Talk</a></li>
                    <li><a href="/category/press-review.html">Press Review</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://didier.bernaudeau.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://didier.bernaudeau.net/How_to_install_OVS.html"
                       rel="bookmark"
                       title="Permalink to How to install OVS (Open Virtual Swtich)">
                        How to install OVS (Open Virtual Swtich)
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-09-05T22:26:00+02:00"> lun. 05 septembre 2016</time>
    </span>
            <span class="label label-default">Modified</span>
            <span class="modified">
                <i class="fa fa-calendar"></i><time datetime="2017-01-30T10:42:00+01:00"> lun. 30 janvier 2017</time>
            </span>





<span class="label label-default">Tags</span>
	<a href="http://didier.bernaudeau.net/tag/virtualization.html">virtualization</a>
        /
	<a href="http://didier.bernaudeau.net/tag/gentoo.html">Gentoo</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Open vSwitch is a virtual switch with advanced functionnality such as isolation (vlan), monitoring and automated control. This tutorial describes how to install Open vSwitch in kernel space and how to configure LibVirt to use a virtual switch with KVM guest.</p>
<p>However, there is a lot of functionality available with Open Virtual Switch that this article does not touch. You can setup VLAN tagging, QoS rules, create re-routing rules, block IP address, block ports, and much more. Feel free to reference online documentation and man pages if you are interested in adding complex functionality to the controller.</p>

<h1>Open Virtual Switch</h1>
<ul>
<li>Configure the kernel</li>
</ul>
<div class="highlight"><pre><span></span>|[*] Networking support  ---&gt;
|     | Networking options  ---&gt;
|     |    | [*] Network packet filtering framework (Netfilter)  ---&gt;
|     |    |         | IPv6: Netfilter Configuration  ---&gt;
|     |    |         |      | &lt;*&gt; IP6 tables support (required for filtering)
|     |    |         |      | &lt;*&gt;   "frag" Fragmentation header match support
|     |    |
|     |    | &lt;*&gt;   Open vSwitch
</pre></div>
<ul>
<li>Enable the version 2.6.1</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> nano /etc/portage/package.keywords
</pre></div>
<div class="highlight"><pre><span></span>=net-misc/openvswitch-2.6.1             ~amd64
=dev-python/ovs-2.6.1                   ~amd64
</pre></div>
<ul>
<li>Define compilation option</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> nano /etc/portage/package.use
</pre></div>
<div class="highlight"><pre><span></span>net-misc/openvswitch    -module
</pre></div>
<ul>
<li>Install packages</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> emerge openvswitch
</pre></div>
<ul>
<li>Create database</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> emerge --config <span class="o">=</span>net-misc/openvswitch-2.6.1
</pre></div>
<p><strong>Note:</strong> The file of this database is "/var/lib/openvswitch/conf.db".</p>
<ul>
<li>Create missing directory</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> mkdir /var/run/openvswitch/
</pre></div>
<ul>
<li>
<p>Configure Network Manager (if used) : Disconnect "cable interface" and disabled "automatically connect".</p>
</li>
<li>
<p>Start OpenSwitch</p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> systemctl start ovsdb-server
<span class="gp">#</span> systemctl start ovs-vswitchd
</pre></div>
<ul>
<li>Create a virtual switch</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> ovs-vsctl add-br vbr0
<span class="gp">#</span> ovs-vsctl set-controller vbr0 ptcp:
<span class="gp">#</span> ovs-vsctl add-port vbr0 enp0s25
<span class="gp">#</span> ovs-vsctl <span class="nb">set</span> bridge vbr0 <span class="nv">stp_enable</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
<ul>
<li>Prints a brief overview of the switch database configuration</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> ovs-vsctl show
</pre></div>
<div class="highlight"><pre><span></span>209fb6b8-d25b-4c1d-874c-0c75bccfca15
    Bridge "vbr0"
        Controller "ptcp:"
        Port "enp0s25"
            Interface "enp0s25"
        Port "vbr0"
            Interface "vbr0"
                type: internal
</pre></div>
<h1>LibVirt</h1>
<ul>
<li>Create an XML file to define a libvirt virtual network</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> nano virtual_switch.xml
<span class="go">&lt;network&gt;</span>
<span class="go">  &lt;name&gt;VirtualSwitch&lt;/name&gt;</span>
<span class="go">  &lt;forward mode='bridge'/&gt;</span>
<span class="go">  &lt;bridge name='vbr0'/&gt;</span>
<span class="go">  &lt;virtualport type='openvswitch'/&gt;</span>
<span class="go">&lt;/network&gt;</span>
</pre></div>
<ul>
<li>Create network in LibVirt</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> virsh net-define virtual_switch.xml
<span class="gp">#</span> virsh net-start VirtualSwitch
<span class="gp">#</span> virsh net-list --all
</pre></div>
<ul>
<li>Restart LibVirt</li>
</ul>
<div class="highlight"><pre><span></span><span class="gp">#</span> systemctl restart libvirtd.service
</pre></div>
<p>Now, the virtual switch is available for the guest VM.</p>
<!--

# Addendum: Local Switch

* Create a virtual switch


wzxhzdk:15


* Prints a brief overview of the switch database configuration


wzxhzdk:16


* Create an XML file to define a libvirt virtual network


wzxhzdk:17


* Create network in LibVirt


wzxhzdk:18


-->
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="60%" class="img-thumbnail" src="/images/avatar.png"/>
        </p>
    <p>
        <strong>About D. Bernaudeau</strong><br/>
        I’m Didier Bernaudeau, an Information Systems Security Professional. This site is a way to note some experimentations.
    </p>
</div>
<section class="well well-sm">
    <ul class="list-group list-group-flush">



            <li class="list-group-item"><a href="http://didier.bernaudeau.net/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/blockchain.html">
                            Blockchain
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://didier.bernaudeau.net/tag/certificate.html">
                            Certificate
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/container.html">
                            Container
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/cryptography.html">
                            Cryptography
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/cups.html">
                            cups
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://didier.bernaudeau.net/tag/debian.html">
                            Debian
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/development.html">
                            Development
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/development-tool.html">
                            Development tool
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://didier.bernaudeau.net/tag/docker.html">
                            Docker
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/framework.html">
                            Framework
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://didier.bernaudeau.net/tag/gentoo.html">
                            Gentoo
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/git.html">
                            Git
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/go.html">
                            Go
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/hardware.html">
                            hardware
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/home-automation.html">
                            Home automation
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/html.html">
                            HTML
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/java.html">
                            Java
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/javascript.html">
                            JavaScript
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://didier.bernaudeau.net/tag/linux.html">
                            Linux
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/network.html">
                            Network
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/pelican.html">
                            Pelican
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/php.html">
                            PHP
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://didier.bernaudeau.net/tag/pki.html">
                            PKI
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://didier.bernaudeau.net/tag/press-review.html">
                            Press review
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://didier.bernaudeau.net/tag/raspberry-pi.html">
                            Raspberry Pi
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/raspbian.html">
                            Raspbian
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/scm.html">
                            SCM
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/software.html">
                            Software
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://didier.bernaudeau.net/tag/spring.html">
                            Spring
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://didier.bernaudeau.net/tag/tls.html">
                            TLS
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/virtualization.html">
                            Virtualization
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://didier.bernaudeau.net/tag/website.html">
                            WebSite
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/windows.html">
                            Windows
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://didier.bernaudeau.net/tag/wireless.html">
                            Wireless
                        </a>
                    </li>
                </ul>
            </li>


    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 D. Bernaudeau
            &middot; Powered by <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://didier.bernaudeau.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://didier.bernaudeau.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://didier.bernaudeau.net/theme/js/respond.min.js"></script>


</body>
</html>